{% extends "bookapp/base.html" %}

{% block title %}Statistics{% endblock %}

{% block content %}

<h2 style="margin-bottom:30px;">ğŸ“Š Statistics Dashboard</h2>

<!-- KPI CARDS -->
<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:20px; margin-bottom:40px;">

    <div class="card">
        <h4>ğŸ“– Most Pages</h4>
        {% if max_pages %}
            <p style="font-size:20px; font-weight:600;">
                {{ max_pages.title }}
            </p>
            <p>{{ max_pages.pages }} pages</p>
        {% else %}
            <p>No data</p>
        {% endif %}
    </div>

    <div class="card">
        <h4>ğŸ“˜ Least Pages</h4>
        {% if min_pages %}
            <p style="font-size:20px; font-weight:600;">
                {{ min_pages.title }}
            </p>
            <p>{{ min_pages.pages }} pages</p>
        {% else %}
            <p>No data</p>
        {% endif %}
    </div>

    <div class="card">
        <h4>ğŸ“Š Avg Pages</h4>
        <p style="font-size:26px; font-weight:700;">
            {{ avg_pages|floatformat:1 }}
        </p>
    </div>

    <div class="card">
        <h4>â­ Avg Rating</h4>
        <p style="font-size:26px; font-weight:700;">
            {{ avg_rating|floatformat:1 }}
        </p>
    </div>

</div>

<!-- CHARTS -->
<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap:30px;">

    <div class="card">
        <h3 style="margin-bottom:20px;">Books by Status</h3>
        <canvas id="statusChart"></canvas>
    </div>

    <div class="card">
        <h3 style="margin-bottom:20px;">Books by Rating</h3>
        <canvas id="ratingChart"></canvas>
    </div>

</div>

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const statusLabels = [
        {% for item in status_data %}
            "{{ item.status }}",
        {% endfor %}
    ];

    const statusCounts = [
        {% for item in status_data %}
            {{ item.count }},
        {% endfor %}
    ];

    const ratingLabels = [
        {% for item in rating_data %}
            "{{ item.rating }}",
        {% endfor %}
    ];

    const ratingCounts = [
        {% for item in rating_data %}
            {{ item.count }},
        {% endfor %}
    ];

    new Chart(document.getElementById("statusChart"), {
        type: 'pie',
        data: {
            labels: statusLabels,
            datasets: [{
                data: statusCounts,
                backgroundColor: ['#f59e0b','#3b82f6','#10b981']
            }]
        }
    });

    new Chart(document.getElementById("ratingChart"), {
        type: 'bar',
        data: {
            labels: ratingLabels,
            datasets: [{
                label: 'Books',
                data: ratingCounts,
                backgroundColor: '#2563eb'
            }]
        }
    });
</script>

{% endblock %}